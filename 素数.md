# 線形篩

```rust
pub struct LinearSieve {
    limit: usize,
    primes: Vec<usize>,
    table: Vec<usize>,
}
impl LinearSieve {
    pub fn new(n: usize) -> Self {
        let mut primes = vec![2];
        let mut table = vec![0; n / 2 + 1];
        for i in 1..=(n - 1) / 2 {
            let d = 2 * i + 1;
            if table[i] == 0 {
                table[i] = d;
                primes.push(d);
            }
            for &p in &primes[1..] {
                if p * d > n || p > table[i] {
                    break;
                }
                table[p * d / 2] = p;
            }
        }
        Self {
            limit: n,
            primes,
            table,
        }
    }

    pub fn is_prime(&self, n: usize) -> bool {
        assert!(n <= self.limit);
        n == 2 || n % 2 == 0 && self.table[n / 2] == n
    }

    pub fn primes(&self) -> &Vec<usize> {
        &self.primes
    }

    pub fn least_prime_factor(&self, n: usize) -> usize {
        assert!(n <= self.limit);
        if n % 2 == 0 {
            return 2;
        }
        self.table[n / 2]
    }
}
```
